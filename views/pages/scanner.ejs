<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <title>Scan Document</title>

    <style type="text/css">  
        /* Flipping the video as it was not mirror view */  
        video {  
            -webkit-transform: scaleX(-1);  
            transform: scaleX(-1);  
            margin-top: 5px;  
        }

                              .form-style-9{
                                  max-width: 800px;
                                  background: #FAFAFA;
                                  padding: 30px;
                                  margin: 50px;
                                  box-shadow: 1px 1px 25px rgba(0, 0, 0, 0.35);
                                  border-radius: 10px;
                                  border: 6px solid #305A72;
                              }
        .form-style-9 ul{
            padding:0;
            margin:0;
            list-style:none;
        }
        .form-style-9 ul li{
            display: block;
            margin-bottom: 10px;
            min-height: 35px;
        }
        .form-style-9 ul li  .field-style{
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            padding: 8px;
            outline: none;
            border: 1px solid #B0CFE0;
            -webkit-transition: all 0.30s ease-in-out;
            -moz-transition: all 0.30s ease-in-out;
            -ms-transition: all 0.30s ease-in-out;
            -o-transition: all 0.30s ease-in-out;

        }.form-style-9 ul li  .field-style:focus{
             box-shadow: 0 0 5px #B0CFE0;
             border:1px solid #B0CFE0;
         }
        .form-style-9 ul li .field-split{
            width: 49%;
        }
        .form-style-9 ul li .field-full{
            width: 100%;
        }
        .form-style-9 ul li input.align-left{
            float:left;
        }
        .form-style-9 ul li input.align-right{
            float:right;
        }
        .form-style-9 ul li textarea{
            width: 100%;
            height: 100px;
        }
        .form-style-9 ul li input[type="button"],
        .form-style-9 ul li input[type="submit"] {
            -moz-box-shadow: inset 0px 1px 0px 0px #3985B1;
            -webkit-box-shadow: inset 0px 1px 0px 0px #3985B1;
            box-shadow: inset 0px 1px 0px 0px #3985B1;
            background-color: #216288;
            border: 1px solid #17445E;
            display: inline-block;
            cursor: pointer;
            color: #FFFFFF;
            padding: 8px 18px;
            text-decoration: none;
            font: 12px Arial, Helvetica, sans-serif;
        }
        .form-style-9 ul li input[type="button"]:hover,
        .form-style-9 ul li input[type="submit"]:hover {
            background: linear-gradient(to bottom, #2D77A2 5%, #337DA8 100%);
            background-color: #28739E;
        }
      
        /* Flipping the canvas image as it was not mirror view */  
        /* #canvas */
    </style>
</head>
<body>
    <div class="jumbotron" style="margin-top:20px;padding:20px;">    
        <p><span id="errorMsg"></span></p>    
        <div class="row">    
            <div class="col-lg-6">    
                <!-- Here we streaming video from webcam -->    
                <h4>    
                    Video coming from Webcam  <button class="btn btn-primary" id="btnCapture">Capture to Canvas >></button>    
                </h4>    
                <video id="video" playsinline autoplay></video>    
            </div>    
        
            <div class="col-lg-6" style="display: none">
                <h4>    
                    Captured image from Webcam <input type="button" class="btn btn-primary" id="btnSave" name="btnSave" value="Save the canvas(image) to server" />    
                </h4>    
                <!-- Webcam video snapshot -->    
                <canvas style="border:solid 1px #ddd;background-color:white;" id="canvas" width="475" height="475"></canvas>    
            </div>    
        </div>

        <!--form-->

        <div>
            <form class="form-style-9">
                <ul>
                    <li>
                        <input type="text" name="firstname" class="field-style field-split align-left" placeholder="Firstname" />
                        <input type="text" name="lastname" class="field-style field-split align-right" placeholder="Lastname" />

                    </li>
                    <li>
                        <input type="email" name="email" class="field-style field-split align-right" placeholder="Email" />
                        <input type="text" name="phone" class="field-style field-split align-left" placeholder="Phone" />
                    </li>
                    <li>
                        <input type="text" name="job_title" class="field-style field-split align-left" placeholder="Job Title" />
                        <input type="text" name="company_name" class="field-style field-split align-right" placeholder="Company Name" />
                    </li>
                    <li>
                        <textarea name="street_address" class="field-style" placeholder="Street Address"></textarea>
                    </li>
                    <li>
                        <input type="text" name="city" class="field-style field-split align-left" placeholder="City" />
                        <input type="text" name="state" class="field-style field-split align-right" placeholder="state" />
                    </li>
                    <li>
                        <input type="text" name="postal_code" class="field-style field-split align-left" placeholder="Postal Code" />
                    </li>
                    <li>
                        <input type="submit" value="Send Message" />
                    </li>
                </ul>
            </form>
        </div>



    </div>     
</body>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
<!--<script>-->
<!--  hbspt.forms.create({-->
<!--    region: "na1",-->
<!--    portalId: "21645343",-->
<!--    formId: "cc7c5c18-09ee-4f8f-9d83-d666807c9cff"-->
<!--  });-->
<!--</script>-->

<script type="text/javascript">  
    var video = document.querySelector("#video");  
  
    // Basic settings for the video to get from Webcam  
    const constraints = {  
        audio: false,  
        video: {  
            width: 475, height: 475  
        }  
    };  
  
    // This condition will ask permission to user for Webcam access  
    if (navigator.mediaDevices.getUserMedia) {  
        navigator.mediaDevices.getUserMedia(constraints)  
            .then(function (stream) {  
                video.srcObject = stream;  
            })  
            .catch(function (err0r) {  
                console.log("Something went wrong!");  
            });  
    }  
  
    function stop(e) {  
        var stream = video.srcObject;  
        var tracks = stream.getTracks();  
  
        for (var i = 0; i < tracks.length; i++) {  
            var track = tracks[i];  
            track.stop();  
        }  
        video.srcObject = null;  
    }  
</script>  
  
<script type="text/javascript">  
    // Below code to capture image from Video tag (Webcam streaming)  
    $("#btnCapture").click(function () {  
        var canvas = document.getElementById('canvas');  
        var destCtx = canvas.getContext('2d');
        destCtx.drawImage(video,0,0);
        destCtx.setTransform(1,0,0,1,0,0);

        var formData = new FormData(),
            uploadedImageName = 'document.png';

        canvas.toBlob(function (blob) {
            formData.append('user_picture', blob, uploadedImageName);
            $.ajax({
                url: '/upload-document',
                data: formData,
                type: "POST",
                dataType: "JSON",
                processData: false,
                contentType: false,
                success: function (res, err){
                    if(res.status) {
                        // TODO add regex on text here.
                    }
                }
            });
        });

    });  


    function dataURItoBlob(dataURI) {
        // convert base64/URLEncoded data component to raw binary data held in a string
        var byteString;
        if (dataURI.split(',')[0].indexOf('base64') >= 0)
            byteString = atob(dataURI.split(',')[1]);
        else
            byteString = unescape(dataURI.split(',')[1]);
        // separate out the mime component
        var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
        // write the bytes of the string to a typed array
        var ia = new Uint8Array(byteString.length);
        for (var i = 0; i < byteString.length; i++) {
            ia[i] = byteString.charCodeAt(i);
        }
        return new Blob([ia], {type:mimeString});
    }
</script> 

</html>